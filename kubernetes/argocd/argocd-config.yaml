# Argo CD Configuration
# ConfigMaps for customizing Argo CD behavior
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-cm
    app.kubernetes.io/part-of: argocd
data:
  # Repository credentials (use sealed secrets in production)
  # repositories: |
  #   - url: https://github.com/YOUR_USERNAME/gitops-platform.git
  #     type: git
  
  # Resource tracking method
  application.resourceTrackingMethod: annotation
  
  # Health customization
  resource.customizations.health.argoproj.io_Application: |
    hs = {}
    hs.status = "Progressing"
    hs.message = ""
    if obj.status ~= nil then
      if obj.status.health ~= nil then
        hs.status = obj.status.health.status
        if obj.status.health.message ~= nil then
          hs.message = obj.status.health.message
        end
      end
    end
    return hs
  
  # Enable status badge
  statusbadge.enabled: "true"
  
  # Admin account enabled
  admin.enabled: "true"
  
  # Dex configuration (for SSO - optional)
  # dex.config: |
  #   connectors:
  #     - type: github
  #       id: github
  #       name: GitHub
  #       config:
  #         clientID: $dex.github.clientID
  #         clientSecret: $dex.github.clientSecret
  #         orgs:
  #           - name: your-org
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-rbac-cm
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-rbac-cm
    app.kubernetes.io/part-of: argocd
data:
  # RBAC policy
  policy.default: role:readonly
  policy.csv: |
    # Admin group
    g, admin, role:admin
    
    # DevOps group - can sync applications
    p, role:devops, applications, sync, */*, allow
    p, role:devops, applications, get, */*, allow
    p, role:devops, applications, override, */*, allow
    g, devops, role:devops
    
    # Developer group - read only
    p, role:developer, applications, get, */*, allow
    p, role:developer, logs, get, */*, allow
    g, developers, role:developer
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cmd-params-cm
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-cmd-params-cm
    app.kubernetes.io/part-of: argocd
data:
  # Server parameters
  server.insecure: "true"  # Set to false in production with TLS
  
  # Controller parameters
  controller.status.processors: "20"
  controller.operation.processors: "10"
  controller.self.heal.timeout.seconds: "5"
  
  # Repo server parameters
  reposerver.parallelism.limit: "0"
